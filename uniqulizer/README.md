# Uniqualizer Script Documentation

## 1. Purpose

The `Uniqualizer` is a Kotlin script designed to automatically refactor and obfuscate Android resource filenames within this project. The primary goal is to make static analysis of the compiled application more difficult by replacing predictable resource names with unique, randomized names.

This process, referred to as "uniquification," is handled by the `M.kt` script located in the `uniqulizer` module.

## 2. Core Logic

The script operates on resource files within the `zsdk` module, specifically targeting the `res/layout` and `res/raw` directories.

The core logic for each file is a two-step process:
1.  **Rename File:** The original filename is transformed into a new, unique name.
2.  **Update References:** The script then performs a global search-and-replace across all project modules (`.kt`, `.java`, `.xml` files) to update any code that references the old resource name (e.g., `R.layout.old_name`) to use the new name (`R.layout.new_name`).

## 3. Modules and Naming Conventions

The script is divided into two main logical components, one for each resource type.

### 3.1. Layout Uniqualizer (`processLayouts`)

-   **Target Directory:** `zsdk/src/main/res/layout`
-   **Naming Rules:**
    -   Files starting with `dialog_` are renamed with the prefix `dialog_abc_`.
    -   Files starting with `activity_` are renamed with the prefix `match_activity_`.
    -   All other layout files are not given a new prefix.
-   **Randomization:** A random 6-character alphanumeric string (e.g., `_a1b2c3`) is appended to the end of every new filename (before the extension).

**Example:**
- `dialog_exit.xml` -> `dialog_abc_exit_a1b2c3.xml`
- `activity_main.xml` -> `match_activity_main_d4e5f6.xml`
- `fragment_game.xml` -> `fragment_game_g7h8i9.xml`

### 3.2. Raw Uniqualizer (`processRaws`)

-   **Target Directory:** `zsdk/src/main/res/raw`
-   **Naming Rules:**
    -   Files with a `.mp3` extension are given the prefix `music_`.
    -   Files with a `.wav` extension (and all other files) are given the prefix `sound_effect_`.
-   **Randomization:** A random 6-character alphanumeric string is appended to the end of every new filename (before the extension).

**Example:**
- `bgm.mp3` -> `music_bgm_j0k1l2.mp3`
- `button_click.wav` -> `sound_effect_button_click_m3n4o5.wav`

## 4. Usage

The script is executed via a custom Gradle task.

1.  **Navigate** to the project root directory.
2.  **Run the command:** `gradlew -p uniqulizer runRefactor`

This will compile and execute the `main` function in `M.kt`.

**IMPORTANT:** The script is currently designed for a **single, clean run**. Before executing, ensure the project's resource files are in their original, unmodified state. Use `git clean -fd` and `git restore .` to clean the workspace.

## 5. Future Improvements: Progressive Randomization

The current script is the first step. The intended future state is a script that can be run multiple times. On each subsequent run, the script should:

1.  Identify files that have already been processed (i.e., they have a `_xxxxxx` random suffix).
2.  **Replace** the existing random suffix with a *new* random suffix, without making the filename longer.
3.  Update the code references to point to the newly renamed file.

This will create a "progressive randomization" effect, where the resource names change with every execution, further enhancing obfuscation. The implementation for this requires careful regex matching to correctly identify the base name and the random part of already-processed files.

---
*This documentation was generated by an AI assistant to clarify the script's functionality and guide future development.*
